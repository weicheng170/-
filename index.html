<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>盒中氣體壓力模擬</title>
  <style>
    body { text-align: center; font-family: sans-serif; background: #f9f9f9; }
    canvas { background: white; border: 2px solid black; display: block; margin: 10px auto; }
    input { margin: 5px; }
  </style>
</head>
<body>
  <h2>盒中氣體壓力模擬</h2>
  <div>
    體積 V: <input id="vol" type="number" value="40000"> 
    粒子數 n: <input id="num" type="number" value="30"> 
    溫度 T: <input id="temp" type="number" value="300">
    <button onclick="init()">開始模擬</button>
  </div>
  <canvas id="box" width="600" height="600"></canvas>
  <p>模擬壓力 P = <span id="pressure">0</span> （模擬單位）</p>

  <script>
    const canvas = document.getElementById("box");
    const ctx = canvas.getContext("2d");

    let particles = [];
    let L, n, T, V;
    let lastTime = Date.now();
    let momentumSum = 0; 
    let wallHits = 0;

    function init() {
      V = parseFloat(document.getElementById("vol").value);
      n = parseInt(document.getElementById("num").value);
      T = parseFloat(document.getElementById("temp").value);

      L = Math.sqrt(V); 
      if (L > 600) L = 600; // 最大畫布限制

      particles = [];
      for (let i = 0; i < n; i++) {
        let angle = Math.random() * 2 * Math.PI;
        let speed = Math.sqrt(T) * (0.5 + Math.random()); // 跟 √T 成比例
        particles.push({
          x: Math.random() * L,
          y: Math.random() * L,
          vx: speed * Math.cos(angle),
          vy: speed * Math.sin(angle),
          r: 4
        });
      }
      lastTime = Date.now();
      momentumSum = 0;
      wallHits = 0;
      requestAnimationFrame(update);
    }

    function update() {
      let now = Date.now();
      let dt = (now - lastTime) / 1000; 
      lastTime = now;

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.strokeRect(0, 0, L, L);

      for (let p of particles) {
        p.x += p.vx * dt * 50;
        p.y += p.vy * dt * 50;

        if (p.x < p.r) {
          p.x = p.r; p.vx *= -1;
          momentumSum += 2 * Math.abs(p.vx);
          wallHits++;
        }
        if (p.x > L - p.r) {
          p.x = L - p.r; p.vx *= -1;
          momentumSum += 2 * Math.abs(p.vx);
          wallHits++;
        }
        if (p.y < p.r) {
          p.y = p.r; p.vy *= -1;
          momentumSum += 2 * Math.abs(p.vy);
          wallHits++;
        }
        if (p.y > L - p.r) {
          p.y = L - p.r; p.vy *= -1;
          momentumSum += 2 * Math.abs(p.vy);
          wallHits++;
        }

        ctx.beginPath();
        ctx.arc(p.x, p.y, p.r, 0, 2 * Math.PI);
        ctx.fillStyle = "blue";
        ctx.fill();
      }

      if (wallHits > 0) {
        let P = momentumSum / (4 * L * dt * wallHits);
        document.getElementById("pressure").textContent = P.toFixed(3);
        momentumSum = 0;
        wallHits = 0;
      }

      requestAnimationFrame(update);
    }
  </script>
</body>
</html>

